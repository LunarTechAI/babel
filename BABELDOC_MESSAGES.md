# BabelDOC Messages - Complete Sequence

This document lists all messages that BabelDOC outputs from beginning to end during a translation process.

## Table of Contents
1. [Simulated Progress Messages (Server-Side)](#simulated-progress-messages)
2. [BabelDOC Actual Messages](#babeldoc-actual-messages)
3. [Progress Bar Stages](#progress-bar-stages)
4. [Completion Messages](#completion-messages)
5. [Error/Warning Messages](#errorwarning-messages)

---

## Simulated Progress Messages

These are generated by the server's progress simulator (not from BabelDOC itself):

| Progress | Message | Timing |
|----------|---------|--------|
| 2% | "Uploading file..." | 0-2s |
| 8% | "Analyzing document structure..." | 2-4s |
| 15% | "Extracting text and formulas..." | 4-8s |
| 25% | "Identifying content sections..." | 8-12s |
| 35% | "Extracting terminology..." | 12-16s |
| 45% | "Translating paragraphs (1/4)..." | 16-20s |
| 55% | "Translating paragraphs (2/4)..." | 20-28s |
| 65% | "Translating paragraphs (3/4)..." | 28-40s |
| 75% | "Translating paragraphs (4/4)..." | 40-60s |
| 82% | "Applying translations..." | 60-80s |
| 88% | "Formatting document..." | 80-100s |
| 93% | "Optimizing layout..." | 100-120s |
| 97% | "Finalizing PDF..." | 120-140s |
| 99% | "Almost complete..." | 140+ seconds |

---

## BabelDOC Actual Messages

These are the actual log messages from BabelDOC during execution:

### Initialization Phase
```
INFO: Loading ONNX model...
INFO: Available Provider: CPUExecutionProvider
INFO: start to translate: [filename].pdf
```

### Automatic Term Extraction
```
INFO: Automatic Term Extraction: Starting term extraction for document
INFO: Using 4 worker threads for automatic term extraction
WARNING: Error during automatic terms extract: [error details]
```

### Document Analysis
```
INFO: Found title paragraph: [document title]
INFO: Found first title paragraph: [document title]
```

### Translation Phase
```
INFO: Translation completed. Total: [X], Successful: [Y], Fallback: [Z]
WARNING: Translation result is too long or too short. Input: [X], Output: [Y]
WARNING: Fallback to simple translation. paragraph id: [id]
WARNING: Translation result is the same as input, fallback. paragraph id: [id]
WARNING: Translation result edit distance is too small. distance: [X], input: [Y], output: [Z]
```

### PDF Generation Phase
```
INFO: Font subsetting completed successfully
INFO: PDF save with clean=True completed successfully
INFO: Peak memory usage: [X] MB
INFO: finish translate: [filename].pdf, cost: [X] seconds
INFO: No TOC found in the original PDF, skipping migration.
```

### Progress Bar Stages (Visual Progress Indicators)
```
Parse PDF and Create Intermediate Representation (1/1) ━━━━━ 19/19 0:00:… 0:00:…
DetectScannedFile (1/1)                                ━━━━━ 19/19 0:00:… 0:00:…
Parse Page Layout (1/1)                                ━━━━━ 38/38 0:00:… 0:00:…
Parse Paragraphs (1/1)                                 ━━━━━ 19/19 0:00:… 0:00:…
Parse Formulas and Styles (1/1)                        ━━━━━ 19/19 0:00:… 0:00:…
Translate Paragraphs (1/1)                             ━━━━━ 245/245 0:00:… 0:00:…
Typesetting (1/1)                                      ━━━━━ 38/38 0:00:… 0:00:…
Add Fonts (1/1)                                        ━━━━━ 195/195 0:00:… 0:00:…
Generate drawing instructions (1/1)                    ━━━━━ 19/19 0:00:… 0:00:…
Subset font (1/1)                                      ━━━━━ 1/1   0:00:… 0:00:…
Save PDF (1/1)                                         ━━━━━ 2/2   0:00:… 0:00:…
```

---

## Completion Messages

### Translation Results Summary
```
INFO: Translation results:
  Original PDF: [filename].pdf
  Total time: [X] seconds
  Monolingual PDF: [filename].[lang].mono.pdf
  Peak memory usage: [X] MB
  Total valid character count: [X]
  Total valid text token count (gpt-4o): [X]

INFO: Total tokens: [X]
INFO: Prompt tokens: [X]
INFO: Completion tokens: [X]
INFO: Cache hit prompt tokens: [X]

INFO: Term extraction tokens: total=[X] prompt=[Y] completion=[Z] cache_hit_prompt=[W]
```

### Cleanup
```
INFO: cleanup temp files: [temp directory path]
INFO: Waiting for translation to finish...
```

### Final Status
```
INFO: openai translate call count: [X]
INFO: openai translate cache call count: [X]
Found mono version: [filename].[lang].mono.pdf
[Server] Completed: [filename].[lang].mono.pdf
```

---

## Error/Warning Messages

### File Validation Errors
```
ERROR: Input file is generated by BabelDOC
ERROR: Cannot translate files that have already been translated.
```

### Translation Quality Warnings
```
WARNING: Translation result is too long or too short. Input: [X], Output: [Y]
WARNING: Translation result is the same as input, fallback.
WARNING: Translation result edit distance is too small.
WARNING: Fallback to simple translation.
```

### Parsing Errors
```
WARNING: Error during automatic terms extract: Unterminated string starting at: line [X] column [Y] (char [Z])
```

---

## Message Flow Sequence

### Complete Execution Flow:

1. **Initialization** (0-2s)
   - Loading ONNX model
   - Available Provider detection
   - Start translation command

2. **Document Parsing** (2-15s)
   - Parse PDF and Create Intermediate Representation
   - Detect Scanned File
   - Parse Page Layout
   - Parse Paragraphs
   - Parse Formulas and Styles

3. **Term Extraction** (15-35s)
   - Automatic Term Extraction starting
   - Using worker threads for extraction

4. **Translation** (35-75s)
   - Translate Paragraphs (main work)
   - Found title paragraph(s)
   - Translation warnings/fallbacks

5. **PDF Generation** (75-97s)
   - Typesetting
   - Add Fonts
   - Generate drawing instructions
   - Subset font
   - Save PDF

6. **Completion** (97-100%)
   - Translation results summary
   - Token usage statistics
   - Memory usage
   - Cleanup temp files
   - Final status

---

## Server-Side Additional Messages

From the FastAPI server wrapper:

```
[Job {job_id}] Running command: uv run babeldoc ...
[Job {job_id}] Progress: [X]% - [message]
[Job {job_id}] Error detected: [error details]
[Job {job_id}] Found mono version: [filename]
[Job {job_id}] Selected file: [filename]
[Job {job_id}] Completed: [filename]
[Job {job_id}] Exception: [error details]
[API] Returning job {job_id}: status=[status], progress=[X]%
```

---

## Notes

- The **simulated progress messages** are generated by the server to provide user feedback while BabelDOC is processing
- The **actual BabelDOC messages** appear in the server logs and stdout/stderr
- Progress percentages in simulated messages don't necessarily match BabelDOC's internal progress
- BabelDOC's progress bar stages show detailed sub-tasks with item counts (e.g., "19/19" pages processed)
- Warnings about translation quality are normal and indicate fallback mechanisms are working
- The entire process typically takes 20-120 seconds depending on document size and complexity

